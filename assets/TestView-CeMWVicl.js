import{d as $,u as J,r as u,o as K,h as x,c as p,w as W,a as m,b as X,e as Y,f as T,g as a,q as Z,i as d,j as E,k as o,l as ee,m as c,t as _,n,E as w,p as te,s as i,v as se,_ as ae}from"./index-CqLU6YTQ.js";const oe={class:"test-container"},ne={class:"card-header"},le={key:0,class:"error-container"},re={key:0,class:"retry-info"},ie={key:1,class:"question-container"},ue={class:"question-number"},de={class:"question-text"},ce={class:"options-container"},_e={class:"navigation-buttons"},y=3,ve=$({__name:"TestView",setup(pe){const M=te(),t=J(),b=u(!0),h=u(!1),r=u(0),k=u(!1),f=u("unknown"),C=async()=>{try{if(b.value=!0,h.value=!1,f.value="unknown",t.resetTest(),await t.initializeTest(),!t.isInitialized)throw new Error("Test not initialized");r.value=0}catch(s){throw h.value=!0,f.value="init",x(s,{context:"Test Initialization",showMessage:!1}),s}finally{b.value=!1}},R=async()=>{if(r.value>=y){w.error("已达到最大重试次数，请刷新页面重新开始");return}k.value=!0,r.value++;try{t.resetTest(),await se(async()=>{await C()},{context:"Test Retry",showMessage:!1})}catch(s){x(s,{context:"Test Retry",showMessage:!0,message:"重试初始化失败"})}finally{k.value=!1}};K(async()=>{try{await C()}catch(s){x(s,{context:"Test Initialization",showMessage:!0,message:"无法加载测试问题，请刷新页面重试"})}});const V=p(()=>t.currentQuestion),Q=p(()=>t.currentQuestionIndex),q=p(()=>t.progress),N=p(()=>t.canGoPrevious),z=Z.length,A=p(()=>Q.value===z-1),l=u(t.getCurrentAnswer);W(V,()=>{l.value=t.getCurrentAnswer});const B=s=>`${s}%`,S=s=>{t.setAnswer(s)},D=()=>{t.previousQuestion()},P=()=>{if(!l.value){w.warning("请选择一个选项");return}t.nextQuestion()},G=()=>{if(!l.value){w.warning("请选择一个选项");return}t.setAnswer(l.value),t.calculateResult()?M.push("/result"):w.error("计算结果时出错，请重试")};return(s,e)=>{const L=d("el-progress"),j=d("el-alert"),g=d("el-button"),v=d("el-radio-button"),F=d("el-radio-group"),H=d("el-card"),O=Y("loading");return i(),m("div",oe,[X((i(),T(H,{class:"test-card","element-loading-text":"加载测试问题中..."},{header:a(()=>[c("div",ne,[o(L,{percentage:q.value,format:B,"stroke-width":20,class:"progress-bar"},null,8,["percentage"])])]),default:a(()=>{var I;return[h.value||!E(t).isInitialized?(i(),m("div",le,[o(j,{title:f.value==="network"?"网络连接失败":"加载测试问题失败",type:"error",description:f.value==="network"?"无法连接到服务器，请检查您的网络连接。":"无法加载测试问题，请尝试重新加载。","show-icon":"",closable:!1},null,8,["title","description"]),r.value>0?(i(),m("div",re,[c("span",null,"已重试 "+_(r.value)+"/"+_(y)+" 次",1)])):ee("",!0),o(g,{class:"retry-button",type:"primary",onClick:R,loading:k.value,disabled:r.value>=y},{default:a(()=>[n(_(r.value>=y?"请刷新页面重试":"重试"),1)]),_:1},8,["loading","disabled"])])):(i(),m("div",ie,[c("div",ue," 问题 "+_(Q.value+1)+"/"+_(E(z)),1),c("div",de,_((I=V.value)==null?void 0:I.text),1),c("div",ce,[o(F,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=U=>l.value=U),class:"radio-group",onChange:S},{default:a(()=>[o(v,{label:1},{default:a(()=>e[1]||(e[1]=[n("非常不同意")])),_:1,__:[1]}),o(v,{label:2},{default:a(()=>e[2]||(e[2]=[n("不同意")])),_:1,__:[2]}),o(v,{label:3},{default:a(()=>e[3]||(e[3]=[n("中立")])),_:1,__:[3]}),o(v,{label:4},{default:a(()=>e[4]||(e[4]=[n("同意")])),_:1,__:[4]}),o(v,{label:5},{default:a(()=>e[5]||(e[5]=[n("非常同意")])),_:1,__:[5]})]),_:1},8,["modelValue"])]),c("div",_e,[o(g,{disabled:!N.value,onClick:D,class:"nav-button"},{default:a(()=>e[6]||(e[6]=[n(" 上一题 ")])),_:1,__:[6]},8,["disabled"]),A.value?(i(),T(g,{key:1,type:"success",disabled:!l.value,onClick:G,class:"nav-button"},{default:a(()=>e[8]||(e[8]=[n(" 完成测试 ")])),_:1,__:[8]},8,["disabled"])):(i(),T(g,{key:0,type:"primary",disabled:!l.value,onClick:P,class:"nav-button"},{default:a(()=>e[7]||(e[7]=[n(" 下一题 ")])),_:1,__:[7]},8,["disabled"]))])]))]}),_:1})),[[O,b.value]])])}}}),ge=ae(ve,[["__scopeId","data-v-2cbb095a"]]);export{ge as default};
