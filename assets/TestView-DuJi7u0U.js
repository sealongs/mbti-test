import{d as $,u as J,r as u,o as K,h as q,c as p,w as W,a as m,b as X,e as Y,f as h,g as s,q as Z,i as d,j as z,k as a,l as ee,m as c,t as _,n,E as y,p as te,s as i,v as se,_ as ae}from"./index-BHhJXQF5.js";const oe={class:"test-container"},ne={class:"card-header"},le={key:0,class:"error-container"},re={key:0,class:"retry-info"},ie={key:1,class:"question-container"},ue={class:"question-number"},de={class:"question-text"},ce={class:"options-container"},_e={class:"navigation-buttons"},b=3,ve=$({__name:"TestView",setup(pe){const E=te(),t=J(),w=u(!0),k=u(!1),r=u(0),x=u(!1),f=u("unknown"),C=async()=>{try{w.value=!0,k.value=!1,f.value="unknown",await t.initializeTest(),r.value=0}catch(o){k.value=!0,f.value="init",q(o,{context:"Test Initialization",showMessage:!1})}finally{w.value=!1}},M=async()=>{if(r.value>=b){y.error("已达到最大重试次数，请刷新页面重新开始");return}x.value=!0,r.value++;try{await se(async()=>{await C()},{context:"Test Retry",showMessage:!1})}finally{x.value=!1}};K(async()=>{try{await C()}catch(o){q(o,{context:"Test Initialization",showMessage:!0,message:"无法加载测试问题，请刷新页面重试"})}});const T=p(()=>t.currentQuestion),V=p(()=>t.currentQuestionIndex),N=p(()=>t.progress),R=p(()=>t.canGoPrevious),Q=Z.length,A=p(()=>V.value===Q-1),l=u(t.getCurrentAnswer);W(T,()=>{l.value=t.getCurrentAnswer});const B=o=>`${o}%`,S=o=>{t.setAnswer(o)},D=()=>{t.previousQuestion()},P=()=>{if(!l.value){y.warning("请选择一个选项");return}t.nextQuestion()},G=()=>{if(!l.value){y.warning("请选择一个选项");return}t.setAnswer(l.value),t.calculateResult()?E.push("/result"):y.error("计算结果时出错，请重试")};return(o,e)=>{const L=d("el-progress"),j=d("el-alert"),g=d("el-button"),v=d("el-radio-button"),F=d("el-radio-group"),H=d("el-card"),O=Y("loading");return i(),m("div",oe,[X((i(),h(H,{class:"test-card","element-loading-text":"加载测试问题中..."},{header:s(()=>[c("div",ne,[a(L,{percentage:N.value,format:B,"stroke-width":20,class:"progress-bar"},null,8,["percentage"])])]),default:s(()=>{var I;return[k.value||!z(t).isInitialized?(i(),m("div",le,[a(j,{title:f.value==="network"?"网络连接失败":"加载测试问题失败",type:"error",description:f.value==="network"?"无法连接到服务器，请检查您的网络连接。":"无法加载测试问题，请尝试重新加载。","show-icon":"",closable:!1},null,8,["title","description"]),r.value>0?(i(),m("div",re,[c("span",null,"已重试 "+_(r.value)+"/"+_(b)+" 次",1)])):ee("",!0),a(g,{class:"retry-button",type:"primary",onClick:M,loading:x.value,disabled:r.value>=b},{default:s(()=>[n(_(r.value>=b?"请刷新页面重试":"重试"),1)]),_:1},8,["loading","disabled"])])):(i(),m("div",ie,[c("div",ue," 问题 "+_(V.value+1)+"/"+_(z(Q)),1),c("div",de,_((I=T.value)==null?void 0:I.text),1),c("div",ce,[a(F,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=U=>l.value=U),class:"radio-group",onChange:S},{default:s(()=>[a(v,{label:1},{default:s(()=>e[1]||(e[1]=[n("非常不同意")])),_:1,__:[1]}),a(v,{label:2},{default:s(()=>e[2]||(e[2]=[n("不同意")])),_:1,__:[2]}),a(v,{label:3},{default:s(()=>e[3]||(e[3]=[n("中立")])),_:1,__:[3]}),a(v,{label:4},{default:s(()=>e[4]||(e[4]=[n("同意")])),_:1,__:[4]}),a(v,{label:5},{default:s(()=>e[5]||(e[5]=[n("非常同意")])),_:1,__:[5]})]),_:1},8,["modelValue"])]),c("div",_e,[a(g,{disabled:!R.value,onClick:D,class:"nav-button"},{default:s(()=>e[6]||(e[6]=[n(" 上一题 ")])),_:1,__:[6]},8,["disabled"]),A.value?(i(),h(g,{key:1,type:"success",disabled:!l.value,onClick:G,class:"nav-button"},{default:s(()=>e[8]||(e[8]=[n(" 完成测试 ")])),_:1,__:[8]},8,["disabled"])):(i(),h(g,{key:0,type:"primary",disabled:!l.value,onClick:P,class:"nav-button"},{default:s(()=>e[7]||(e[7]=[n(" 下一题 ")])),_:1,__:[7]},8,["disabled"]))])]))]}),_:1})),[[O,w.value]])])}}}),ge=ae(ve,[["__scopeId","data-v-1b1d82d1"]]);export{ge as default};
